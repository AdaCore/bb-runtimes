To use:

C-t n: next terminal
C-t C-r: reset
C-t C-b: send a break
C-t C-h: smc to monitor

To build:

 rm -f obj/*.o; gprbuild --target=aarch64-elf --RTS=../../install/aarch64-elf/lib/gnat/ravenscar-sfp-rpi3mc/  -largs -Wl,-Map,main.map
 aarch64-elf-objcopy -O binary obj/main /media/gingold/boot/kernel7.img 
 udisksctl unmount -b /dev/sda1; udisksctl unmount -b /dev/sda2

To rebuild dir.S:
 ./multilevel.py --gen-dir > dir.S
 
To build linux:
 make ARCH=arm64 Image
 cp xxx/arch/arm64/boot/Image linux/

To dump dtb:
 dtc -O dts linux/mc.dtb

To build dtb:
 dtc -O dtb linux/mc.dts

To run qemu:
 qemu-system-aarch64 -m 1024 -M virt -nographic -kernel linux-4.11.1/arch/arm64/boot/Image -initrd initramfs.cpio.gz -cpu cortex-a53

To dump dtb in qemu:
.... -machine dumpdtb=qemu.dtb

To build a initramfs image:
 linux-4.11.1/usr/gen_init_cpio initramfs.list | gzip  > initramfs.cpio.gz

initramfs.list:
dir /dev 755 0 0
nod /dev/console 644 0 0 c 5 1
nod /dev/loop0 644 0 0 b 7 0
dir /bin 755 1000 1000
slink /bin/sh busybox 777 0 0
file /bin/busybox bin/busybox 755 0 0
dir /proc 755 0 0
dir /sys 755 0 0
dir /mnt 755 0 0
#  file /init initramfs/init.sh 755 0 0


To build busybox:
 make -C busybox-1.26.2 CROSS_COMPILE=aarch64-linux-gnu- CC=aarch64-linux-gnu-gcc-4.8 -j8

To configure busybox:
--- .config	2017-06-23 17:23:13.109256714 +0200
+++ .config.tg	2017-06-23 17:23:09.865251814 +0200
@@ -31,15 +31,15 @@
 CONFIG_FEATURE_SUID_CONFIG=y
 CONFIG_FEATURE_SUID_CONFIG_QUIET=y
 # CONFIG_SELINUX is not set
-# CONFIG_FEATURE_PREFER_APPLETS is not set
-CONFIG_BUSYBOX_EXEC_PATH="/proc/self/exe"
+CONFIG_FEATURE_PREFER_APPLETS=y
+CONFIG_BUSYBOX_EXEC_PATH="/bin/busybox"
 CONFIG_FEATURE_SYSLOG=y
 # CONFIG_FEATURE_HAVE_RPC is not set
 
 #
 # Build Options
 #
-# CONFIG_STATIC is not set
+CONFIG_STATIC=y
 # CONFIG_PIE is not set
 # CONFIG_NOMMU is not set
 # CONFIG_BUILD_LIBBUSYBOX is not set
@@ -100,7 +100,7 @@
 CONFIG_FEATURE_TAB_COMPLETION=y
 CONFIG_FEATURE_USERNAME_COMPLETION=y
 CONFIG_FEATURE_EDITING_FANCY_PROMPT=y
-# CONFIG_FEATURE_EDITING_ASK_TERMINAL is not set
+CONFIG_FEATURE_EDITING_ASK_TERMINAL=y
 # CONFIG_LOCALE_SUPPORT is not set
 CONFIG_UNICODE_SUPPORT=y
 # CONFIG_UNICODE_USING_LOCALE is not set
@@ -1069,8 +1069,8 @@
 # CONFIG_MSH is not set
 CONFIG_FEATURE_SH_MATH=y
 CONFIG_FEATURE_SH_MATH_64=y
-CONFIG_FEATURE_SH_EXTRA_QUIET=y
-# CONFIG_FEATURE_SH_STANDALONE is not set
+# CONFIG_FEATURE_SH_EXTRA_QUIET is not set
+CONFIG_FEATURE_SH_STANDALONE=y
 # CONFIG_FEATURE_SH_NOFORK is not set
 CONFIG_FEATURE_SH_HISTFILESIZE=y
